var data = [[1632.2, 1764.8, 1664.5, 1682.9, 1476.7, 1627.2, 1388.7, 1534.5, 1417.5, 1181.1055555549538, 1001.3555555546773, 821.6055555544008], [921.3, 927.0, 916.1, 896.4, 811.9, 866.0, 779.9, 816.4, 783.2, 639.961111111712, 541.0444444453242, 442.12777777893643], [1750.8, 1763.7, 1705.4, 1720.3, 1575.2, 1665.6, 1492.8, 1583.8, 1552.7, 1313.3888888895017, 1162.3888888897782, 1011.3888888900547], [1272.2, 1254.1, 1203.8, 1193.5, 1086.0, 1143.0, 1031.0, 1093.9, 1060.9, 833.0294444439496, 689.5377777770627, 546.0461111101758], [1415.1, 1385.3, 1389.4, 1430.6, 1287.4, 1280.1, 1140.4, 1340.1, 1292.6, 1095.4149999998772, 989.2399999998233, 883.0649999997695], [1550.2, 1586.2, 1507.2, 1490.3, 1368.8, 1425.1, 1287.5, 1368.3, 1334.7, 1064.97833333358, 896.6200000003591, 728.2616666671383], [1678.9, 1797.8, 1746.2, 1718.6, 1553.7, 1632.0, 1484.5, 1595.8, 1540.5, 1314.2400000004855, 1166.7733333340439, 1019.306666667595], [1744.9, 1713.1, 1661.3, 1652.3, 1494.0, 1560.9, 1411.6, 1505.6, 1452.2, 1140.237222222102, 941.5622222220554, 742.8872222219943], [1659.3, 1693.6, 1683.3, 1683.3, 1534.8, 1593.9, 1478.4, 1584.0, 1567.3, 1389.3888888888832, 1289.722222222219, 1190.0555555555547], [1584.2, 1722.4, 1716.7, 1560.1, 1413.0, 1476.5, 1318.6, 1421.8, 1397.5, 1048.7711111124372, 838.0711111130513, 627.3711111136654], [1248.8, 1245.1, 1212.1, 1233.7, 1133.6, 1196.3, 1064.8, 1089.8, 1004.5, 833.3094444443122, 685.3844444442584, 537.4594444441973], [901.9, 915.4, 893.1, 895.3, 817.7, 872.6, 807.2, 901.5, 877.8, 814.8566666665447, 787.139999999823, 759.4233333331013], [1079.3, 1103.2, 1080.9, 1076.0, 1012.5, 1062.9, 959.3, 1010.1, 971.3, 862.1066666671541, 781.473333334041, 700.8400000009278], [1030.2, 1039.9, 987.4, 1018.6, 920.8, 963.9, 864.3, 918.3, 891.6, 735.7594444443239, 634.08444444427, 532.4094444442089], [1001.3, 989.7, 968.6, 968.2, 868.8, 909.7, 808.5, 867.6, 837.7, 656.787777777281, 540.1711111103941, 423.55444444350724], [1323.0, 1338.7, 1283.1, 1267.3, 1173.7, 1248.8, 1127.4, 1180.2, 1161.2, 967.4011111103828, 846.3511111100524, 725.3011111097221], [2309.1, 2303.0, 2202.5, 2318.6, 2058.5, 2069.6, 1801.0, 2050.3, 1998.4, 1563.7461111106095, 1309.3377777770656, 1054.9294444435072], [1592.5, 1629.7, 1587.0, 1528.8, 1413.5, 1517.7, 1407.0, 1477.0, 1420.7, 1230.204444443967, 1103.8377777770802, 977.471111110186], [1177.0, 1218.4, 1188.1, 1213.3, 1097.6, 1158.5, 1019.6, 1120.4, 1052.1, 921.0100000001185, 822.2266666668438, 723.4433333335619], [1375.3, 1412.6, 1364.2, 1375.9, 1275.1, 1413.2, 1312.7, 1357.8, 1236.0, 1202.639444444685, 1137.0311111114643, 1071.4227777782398], [875.5, 863.7, 854.8, 837.1, 771.5, 813.8, 732.7, 770.2, 752.4, 617.2266666667929, 530.5266666668467, 443.82666666690056], [1395.1, 1409.0, 1368.2, 1371.4, 1274.9, 1327.0, 1212.2, 1279.7, 1257.3, 1084.136111110507, 976.1777777768948, 868.2194444432826], [1149.7, 1137.9, 1111.1, 1061.6, 974.0, 1015.3, 923.6, 965.3, 930.3, 696.8049999997602, 545.413333332981, 394.0216666662018], [900.1, 887.2, 859.2, 947.8, 858.7, 903.6, 809.7, 854.4, 844.6, 788.9288888887659, 750.2955555553781, 711.6622222219885], [1429.2, 1530.2, 1510.0, 1513.6, 1449.1, 1535.7, 1424.4, 1457.9, 1441.6, 1418.8488888884021, 1392.4822222215153, 1366.1155555546284], [1099.6, 1094.0, 1069.7, 1053.6, 977.4, 1018.4, 944.0, 998.9, 963.5, 819.6894444452846, 726.664444445676, 633.6394444460602], [1040.3, 1038.9, 1015.2, 999.0, 902.9, 940.1, 836.1, 902.5, 880.9, 682.273888888405, 560.2822222215182, 438.290555554624], [1710.3, 1723.6, 1686.7, 1669.9, 1485.3, 1558.3, 1389.8, 1532.4, 1454.5, 1156.9077777787606, 965.0577777792059, 773.2077777796512], [865.9, 867.3, 851.1, 854.3, 797.3, 834.7, 742.1, 804.3, 774.4, 675.9566666665451, 609.9066666664876, 543.8566666664337], [1983.9, 2331.0, 2314.9, 2370.1, 2087.6, 2224.1, 1910.1, 2081.7, 1948.3, 1800.662777777281, 1646.8377777770584, 1493.012777776843], [985.4, 994.6, 950.4, 975.2, 873.6, 925.6, 822.5, 874.0, 850.5, 695.6199999996388, 595.0533333328058, 494.48666666597273], [1460.2, 1431.2, 1388.6, 1309.7, 1193.2, 1260.6, 1125.2, 1198.5, 1162.6, 829.2822222223476, 623.9155555557372, 418.54888888912683], [3395.4, 3577.1, 3443.0, 3491.8, 3102.5, 3275.5, 2954.3, 3191.3, 3048.4, 2589.9761111116095, 2278.384444445168, 1966.7927777787263]];

var cities = ['City of London', 'Barking and Dagenham', 'Barnet', 'Bexley', 'Brent', 'Bromley', 'Camden', 'Croydon', 'Ealing', 'Enfield', 'Greenwich', 'Hackney', 'Hammersmith and Fulham', 'Haringey', 'Harrow', 'Havering', 'Hillingdon', 'Hounslow', 'Islington', 'Kensington and Chelsea', 'Kingston upon Thames', 'Lambeth', 'Lewisham', 'Merton', 'Newham', 'Redbridge', 'Richmond upon Thames', 'Southwark', 'Sutton', 'Tower Hamlets', 'Waltham Forest', 'Wandsworth', 'Westminster']


var width = 1000,
    height = 400;

var colors = d3.scale.category20();

var tooltip = d3.select('#chart').append('div')
  .style('position', 'absolute')
  .style('padding', '4px 6px')
  .style('background', 'white')
  .style('opacity', 0)
  .style('font-family', 'sans-serif');

var plot = function(i){

  d3.select('svg').remove();

  var ratings = data.map(a => a[i]);

var yScale = d3.scale.linear()
              .domain([0, d3.max(ratings)])
              .range([0, height]);

var xScale = d3.scale.ordinal()
             .domain(d3.range(0, data.length))
             .rangeBands([0, width]);

var myChart = d3.select('#chart').append('svg')
      .attr('width', width)
      .attr('height', height)
      .append('g')
      .selectAll('rect')
      .data(ratings)
        .enter().append('rect')
        .style('fill', colors)
        .attr('width', xScale.rangeBand())
        .attr('height', function(d){
          return yScale(d);
        })
        .attr('x', function(d, i){
           return xScale(i);
        })
        .attr('y', function(d){
          return height - yScale(d);
        })
        .on('mouseover', function(d, i){
          tooltip.transition()
            .style('opacity', 1);
          tooltip.html(cities[i])
            .style('left', (d3.event.pageX - 35)+'px')
            .style('top', (d3.event.pageY - 30)+'px');

          d3.select(this).style('opacity', 0.5);

          setTimeout(function(){
            tooltip.style('opacity', 0);
          }, 2000)
        })
        .on('mouseout', function(d){
          d3.select(this).style('opacity', 1);
        })

  d3.select('svg').selectAll("text")
   .data(ratings)
   .enter()
   .append('text')
   .text(function(d){
      return parseInt(d, 10);
    })
   .attr('x', function(d, i){
       return xScale(i) + 2;
    })
   .attr('y', function(d, i){
      return height - yScale(d) + 15;
    })
   .attr("font-family", "sans-serif")
   .attr("font-size", "11px")
   .attr("fill", "white");

}
